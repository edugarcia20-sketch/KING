<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KING ‚Äî v5.7.4 Calend√°rio Vivo (Rei Vivo)</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<meta name="theme-color" content="#0a0a0a">
<style>
  :root{
    --bg:#050505;
    --card:#0e0e0e;
    --muted:#aeb6bd;
    --text:#f6f6f6;
    --gold:#d4af37;
    --red:#8b0000;
    --smoke:rgba(255,255,255,0.12); /* caixinhas mais claras */
    --smoke-weak:rgba(255,255,255,0.06);
    --glass:rgba(255,255,255,0.03);
    --taskbar-h:90px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:'Poppins',sans-serif;-webkit-font-smoothing:antialiased}
  a{color:inherit;text-decoration:none}

  /* HEADER */
  .header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
  .brand{display:flex;flex-direction:column}
  .brand .title{font-weight:700;color:var(--gold);letter-spacing:0.4px}
  .brand .sub{font-size:12px;color:var(--muted);margin-top:4px}
  .controls{display:flex;gap:8px;align-items:center}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.05);padding:8px 10px;border-radius:10px;color:var(--text);cursor:pointer;font-size:13px}
  .btn.primary{background:linear-gradient(90deg,var(--gold),#ffd66b);border:0;color:#050505;font-weight:700}

  /* monthly thin bar */
  .monthly-wrap{padding:10px 14px}
  .monthly-bar{height:6px;background:rgba(255,255,255,0.02);border-radius:6px;border:1px solid rgba(255,255,255,0.03);overflow:hidden}
  .monthly-fill{height:100%;width:0;background:linear-gradient(90deg,var(--gold),#ffd66b);transition:width .6s ease}

  /* main calendar area */
  main{flex:1;display:block;height:calc(100vh - 172px);overflow:auto;padding:14px}
  .calendar{max-width:1200px;margin:0 auto;display:flex;flex-direction:column;gap:12px}
  .weeknames{display:grid;grid-template-columns:repeat(7,1fr);gap:12px}
  .wday{font-weight:700;text-align:center;color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:12px}
  .cell{
    background:var(--smoke);
    min-height:96px;
    border-radius:12px;
    padding:10px;
    border:1px solid rgba(255,255,255,0.04);
    position:relative;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
    align-items:flex-start;
    transition:all .15s ease;
    cursor:pointer;
  }
  .cell:hover{transform:translateY(-6px);box-shadow:0 28px 64px rgba(0,0,0,0.55)}
  .cell .num{font-weight:700;font-size:18px}
  .cell .preview{font-size:13px;color:var(--muted);margin-top:8px}
  .cell.past{opacity:0.55;filter:grayscale(.04)}
  .cell.today{outline:3px solid rgba(212,175,55,0.16);box-shadow:0 10px 36px rgba(212,175,55,0.05)}
  .cell.folga{background:linear-gradient(180deg, rgba(139,0,0,0.14), rgba(139,0,0,0.06));border:1px solid rgba(139,0,0,0.13)}
  .cell .tag{position:absolute;right:8px;bottom:8px;font-size:11px;color:rgba(255,255,255,0.85)}
  /* make cells responsive taller on larger screens */
  @media(min-width:900px){ .cell{min-height:110px} }

  /* TASKBAR */
  .taskbar{position:fixed;left:14px;right:14px;bottom:14px;height:var(--taskbar-h);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));border-radius:18px;display:flex;align-items:center;justify-content:space-between;padding:12px 18px;border:1px solid rgba(255,255,255,0.03);z-index:40;backdrop-filter:blur(6px)}
  .slot{display:flex;gap:14px;align-items:center}
  .icon{width:64px;height:64px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted);font-size:20px;cursor:pointer;transition:all .12s}
  .icon:hover{transform:translateY(-4px);box-shadow:0 18px 36px rgba(0,0,0,0.45)}
  .icon:active{transform:scale(.98)}

  /* modal overlay */
  .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:linear-gradient(rgba(0,0,0,0.6),rgba(0,0,0,0.6));z-index:90;padding:12px}
  .panel{width:100%;max-width:920px;background:linear-gradient(180deg,#0b0b0b,#0a0a0a);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 40px 120px rgba(0,0,0,0.6)}
  .panel .head{display:flex;justify-content:space-between;align-items:center}
  .panel .head h3{margin:0}
  .close-x{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 10px;border-radius:8px;color:var(--muted);cursor:pointer}

  /* day modal body */
  .sections{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
  .section{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
  .section h4{margin:0 0 6px 0;font-size:14px}
  .row{display:flex;gap:8px;align-items:center}
  textarea, input, select{width:100%;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);resize:vertical}
  textarea{min-height:60px}

  /* small */
  .small{font-size:13px;color:var(--muted)}
  .right-actions{display:flex;gap:8px;align-items:center}

  /* floating health actions */
  .float-actions{position:fixed;right:20px;bottom:calc(14px + var(--taskbar-h) + 12px);display:flex;flex-direction:column;gap:10px;z-index:120}
  .fab{width:56px;height:56px;border-radius:999px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--gold),#f5d37a);color:#050505;font-weight:700;box-shadow:0 18px 36px rgba(212,175,55,0.18);cursor:pointer;border:none}
  .fab.small{width:48px;height:48px;background:linear-gradient(180deg,#fff2d0,#ffd66b);font-size:14px}

  @media(max-width:900px){
    .panel{padding:12px}
    .cell{min-height:86px}
    .icon{width:58px;height:58px}
    .taskbar{left:10px;right:10px}
    .float-actions{right:12px;bottom:calc(10px + var(--taskbar-h) + 8px)}
  }
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="brand">
    <div class="title">üëë KING</div>
    <div class="sub">v5.7.4 ‚Äî Calend√°rio Vivo (Rei Vivo)</div>
  </div>
  <div class="controls">
    <button class="btn" id="saveBtn">Salvar</button>
    <button class="btn" id="exportBtn">Exportar</button>
  </div>
</header>

<!-- MONTHLY -->
<div class="monthly-wrap">
  <div class="monthly-bar"><div id="monthlyFill" class="monthly-fill"></div></div>
</div>

<!-- MAIN CALENDAR -->
<main>
  <div class="calendar" role="application" aria-label="Calend√°rio do m√™s">
    <div class="weeknames" id="weekHead"></div>
    <div id="calendarGrid" class="grid" role="grid" aria-live="polite"></div>
  </div>
</main>

<!-- TASKBAR -->
<div class="taskbar" role="navigation" aria-label="Barra de tarefas">
  <div class="slot left-slot">
    <div class="icon" id="homeBtn" title="Home">üè†</div>
    <div class="icon" id="monthBtn" title="M√™s">üìÖ</div>
  </div>

  <div class="slot center-slot" style="gap:18px">
    <div class="icon" id="healthIcon" title="Sa√∫de">üíß</div>
    <div class="icon" id="agendaIcon" title="Agenda">üóÇÔ∏è</div>
  </div>

  <div class="slot right-slot">
    <div class="icon" id="bauBtn" title="BA√ö">üß∞</div>
    <div class="icon" id="settingsBtn" title="Config">‚öôÔ∏è</div>
  </div>
</div>

<!-- floating action buttons for health (appear when health modal open) -->
<div class="float-actions" id="floatActions" style="display:none">
  <button class="fab" id="fabAddFood" title="Adicionar alimento">üçΩ</button>
  <button class="fab small" id="fabAddWater" title="+150 ml">+150</button>
</div>

<!-- DAY MODAL -->
<div class="modal" id="dayModal" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true" aria-labelledby="dayTitle">
    <div class="head">
      <div>
        <h3 id="dayTitle">Dia</h3>
        <div class="small" id="daySubtitle"></div>
      </div>
      <div class="right-actions">
        <button class="close-x" id="closeDay">Fechar</button>
      </div>
    </div>

    <div class="sections">
      <div class="section">
        <h4>Trabalho</h4>
        <div class="small">Hor√°rio calculado (refer√™ncia de sa√≠da/chegada)</div>
        <div style="margin-top:8px" id="workTime" class="small"></div>
      </div>

      <div class="section">
        <h4>Alimenta√ß√£o</h4>
        <div class="small">Sugest√µes (edite se necess√°rio)</div>
        <div style="margin-top:8px" id="mealsContainer"></div>
      </div>

      <div class="section">
        <h4>Treino</h4>
        <label class="small">Intensidade</label>
        <select id="trainIntensity" style="margin-top:6px">
          <option value="high">Alta</option>
          <option value="moderate">Moderada</option>
          <option value="low">Leve</option>
        </select>
        <div style="margin-top:8px" class="small">Dura√ß√£o (horas)</div>
        <input id="trainDuration" type="number" min="0" max="4" step="0.5" value="1.5" style="margin-top:6px" />
      </div>

      <div class="section">
        <h4>Gastos & Ganhos</h4>
        <div class="small">Adicione gastos (negativo) ou ganhos (positivo)</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="txDesc" placeholder="Descri√ß√£o (ex.: aluguel)" />
          <input id="txValue" placeholder="Valor R$" type="number" />
          <button class="btn" id="addTx">Adicionar</button>
        </div>
        <div id="txList" style="margin-top:8px"></div>
      </div>

      <div class="section">
        <h4>Exerc√≠cios (em casa)</h4>
        <textarea id="exList" placeholder="Ex.: Peito ‚Äî 3 exerc√≠cios x 2 rounds"></textarea>
      </div>

      <div class="section">
        <h4>Tarefas de Casa</h4>
        <div class="small">Rotina de limpeza (editar frequ√™ncia quando quiser)</div>
        <textarea id="chores" placeholder="Ex.: Varrer a cada 3 dias, passar pano a cada 6 dias"></textarea>
      </div>

      <div style="display:flex;justify-content:flex-end;gap:8px">
        <button class="btn" id="deleteDay">Apagar dia</button>
        <button class="btn primary" id="saveDay">Salvar</button>
      </div>
    </div>
  </div>
</div>

<!-- HEALTH MODAL -->
<div class="modal" id="healthModal" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true" aria-labelledby="healthTitle">
    <div class="head">
      <div>
        <h3 id="healthTitle">Painel de Sa√∫de</h3>
        <div class="small" id="healthSub">Resumo r√°pido</div>
      </div>
      <div class="right-actions">
        <button class="close-x" id="closeHealth">Fechar</button>
      </div>
    </div>

    <div style="margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <div>
        <div class="small">Hidrata√ß√£o</div>
        <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
          <div style="text-align:center;cursor:pointer" id="bottleAwrap">
            <div id="hydA" style="font-weight:700;color:var(--gold);font-size:18px">0/4</div>
            <div class="small">Garrafa A</div>
          </div>
          <div style="text-align:center;cursor:pointer" id="bottleBwrap">
            <div id="hydB" style="font-weight:700;color:var(--gold);font-size:18px">0/4</div>
            <div class="small">Garrafa B</div>
          </div>
          <div style="margin-left:auto">
            <button class="btn" id="add25">+25 ml</button>
            <div class="small" style="margin-top:8px">Total: <strong id="waterTotal">0</strong> ml</div>
          </div>
        </div>

        <div style="margin-top:12px" class="small">√Ågua Meta: <strong id="metaWater">2100</strong> ml</div>
      </div>

      <div>
        <div class="small">Kcal (hoje)</div>
        <div style="margin-top:8px;font-weight:700" id="kcalToday">0 / 2606</div>
        <div style="margin-top:12px" class="small">Sono</div>
        <div style="margin-top:6px" id="sleepToday">0 / 8h</div>
        <div style="margin-top:12px" class="small">Treino</div>
        <div style="margin-top:6px" id="trainToday">‚Äî</div>
      </div>
    </div>

    <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
      <div class="small">Registre alimentos e √°gua rapidamente</div>
      <div style="display:flex;gap:10px">
        <button class="btn" id="btnAddWaterTop">+150 ml</button>
        <button class="btn primary" id="btnAddFoodTop">Adicionar alimento</button>
      </div>
    </div>
  </div>
</div>

<script>
/* KING v5.7.4 - updated features:
   - taskbar size and spacing
   - icons mapped to functions (only healthIcon opens health)
   - precise work time calculation using travel_time / arrival buffer
   - floating action buttons for health (+150 ml and add food)
   - add-food prompt adds calories to today's record
   - all data stored in localStorage with prefix
*/

/* storage keys & defaults */
const PREFIX = 'KING_v574_';
const KEY_DAY = PREFIX + 'days';
const KEY_HYD = PREFIX + 'hydration';
const KEY_HEALTH = PREFIX + 'health';
const META = { kcal:2606, agua:2100, sono:8 };

/* folgas */
const FOLGAS = new Set([4,9,18,23,24]);

/* travel params */
const TRAVEL_MIN = 60; // minutes travel time (user: 1 hour)
const ARRIVE_BUFFER_MIN = 20; // arrive 20 minutes early

/* helpers */
function load(key, fallback){ try{ const s = localStorage.getItem(key); return s ? JSON.parse(s) : fallback; }catch(e){ return fallback; } }
function save(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

let days = load(KEY_DAY, {});
let hydration = load(KEY_HYD, {bottles:[0,0], extra:0});
let health = load(KEY_HEALTH, {});

/* DOM refs */
const weekHead = document.getElementById('weekHead');
const calendarGrid = document.getElementById('calendarGrid');
const monthlyFill = document.getElementById('monthlyFill');
const saveBtn = document.getElementById('saveBtn');
const exportBtn = document.getElementById('exportBtn');

const dayModal = document.getElementById('dayModal');
const dayTitle = document.getElementById('dayTitle');
const daySubtitle = document.getElementById('daySubtitle');
const workTimeEl = document.getElementById('workTime');
const mealsContainer = document.getElementById('mealsContainer');
const trainIntensity = document.getElementById('trainIntensity');
const trainDuration = document.getElementById('trainDuration');
const txDesc = document.getElementById('txDesc');
const txValue = document.getElementById('txValue');
const txList = document.getElementById('txList');
const addTxBtn = document.getElementById('addTx');
const exList = document.getElementById('exList');
const chores = document.getElementById('chores');
const saveDayBtn = document.getElementById('saveDay');
const deleteDayBtn = document.getElementById('deleteDay');
const closeDayBtn = document.getElementById('closeDay');

const healthModal = document.getElementById('healthModal');
const healthIcon = document.getElementById('healthIcon');
const agendaIcon = document.getElementById('agendaIcon');
const bauIcon = document.getElementById('bauBtn');
const settingsIcon = document.getElementById('settingsBtn');
const homeBtn = document.getElementById('homeBtn');
const monthBtn = document.getElementById('monthBtn');

const hydA = document.getElementById('hydA');
const hydB = document.getElementById('hydB');
const add25Btn = document.getElementById('add25');
const waterTotal = document.getElementById('waterTotal');
const kcalToday = document.getElementById('kcalToday');
const sleepToday = document.getElementById('sleepToday');
const trainToday = document.getElementById('trainToday');
const confirmHealthBtn = document.getElementById('confirmHealth');
const bottleAwrap = document.getElementById('bottleAwrap');
const bottleBwrap = document.getElementById('bottleBwrap');
const btnAddWaterTop = document.getElementById('btnAddWaterTop');
const btnAddFoodTop = document.getElementById('btnAddFoodTop');

const floatActions = document.getElementById('floatActions');
const fabAddFood = document.getElementById('fabAddFood');
const fabAddWater = document.getElementById('fabAddWater');

/* date helpers */
function pad(n){ return String(n).padStart(2,'0'); }
function keyFrom(y,m,d){ return `${y}-${pad(m)}-${pad(d)}`; }
function todayKey(){ const n=new Date(); return keyFrom(n.getFullYear(), n.getMonth()+1, n.getDate()); }
function prettyKey(k){ const p=k.split('-'); return new Date(p[0], p[1]-1, p[2]).toLocaleDateString(); }

/* week header */
const weekdayNames = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];
function renderWeekHead(){ weekHead.innerHTML=''; weekdayNames.forEach(n=>{ const w=document.createElement('div'); w.className='wday'; w.innerText=n; weekHead.appendChild(w); }); }

/* compute work shifts (base) */
function getShiftTimesForWeekday(dateObj){
  // returns object with shift_start (Date), shift_end (Date)
  // note: returns null if day is folga? We'll still return shift times defined for each weekday
  const year = dateObj.getFullYear(), month = dateObj.getMonth(), day = dateObj.getDate();
  const wd = dateObj.getDay(); // 0 Sun - 6 Sat
  // default times as strings "HH:MM" local
  const map = {
    0: {start:'15:00', end:'00:20'}, // Sunday
    1: {start:'14:00', end:'22:20'}, // Monday
    2: {start:'14:00', end:'22:20'}, // Tue
    3: {start:'18:00', end:'01:20'}, // Wed
    4: {start:'19:00', end:'02:20'}, // Thu
    5: {start:'19:00', end:'02:20'}, // Fri
    6: {start:'19:00', end:'02:20'}  // Sat
  };
  const times = map[wd];
  // parse start
  const [sh,sm] = times.start.split(':').map(Number);
  const [eh,em] = times.end.split(':').map(Number);
  // shift_start date object:
  const startDT = new Date(year, month, day, sh, sm);
  // For end, if end hour less than start hour (overnight), add 1 day
  let endDT = new Date(year, month, day, eh, em);
  if(endDT <= startDT) endDT = new Date(endDT.getTime() + 24*60*60*1000);
  return { start: startDT, end: endDT };
}

/* Build human-readable work schedule with travel/time buffers */
function formatWorkReference(dateObj){
  const shift = getShiftTimesForWeekday(dateObj);
  const travelMs = TRAVEL_MIN * 60 * 1000;
  const bufferMs = ARRIVE_BUFFER_MIN * 60 * 1000;
  const arrivalAtWork = new Date(shift.start.getTime() - bufferMs);
  const departHome = new Date(arrivalAtWork.getTime() - travelMs);
  const departWork = shift.end; // leave shop at end time
  const arriveHome = new Date(departWork.getTime() + travelMs);
  // format times
  function fmt(d){ return `${pad(d.getHours())}:${pad(d.getMinutes())}`; }
  return `Sa√≠da de casa (ref): ${fmt(departHome)} ‚Äî Chegada ao trabalho (ref): ${fmt(arrivalAtWork)}\nSa√≠da do servi√ßo: ${fmt(departWork)} ‚Äî Chegada em casa (ref): ${fmt(arriveHome)}`;
}

/* render calendar month (starts Sunday) */
function renderCalendar(){
  if(!calendarGrid) return;
  calendarGrid.innerHTML='';
  const now = new Date();
  const Y = now.getFullYear(), M = now.getMonth();
  const firstWeekday = new Date(Y,M,1).getDay();
  const daysInMonth = new Date(Y,M+1,0).getDate();

  for(let i=0;i<firstWeekday;i++){
    const blank=document.createElement('div');
    calendarGrid.appendChild(blank);
  }

  for(let d=1; d<=daysInMonth; d++){
    const cell = document.createElement('div');
    cell.className = 'cell';
    const num = document.createElement('div'); num.className='num'; num.innerText = d;
    const preview = document.createElement('div'); preview.className='preview';
    const k = keyFrom(Y,M+1,d);
    const saved = days[k] || {};
    if(saved.foodShort) preview.innerText = 'üçΩ ' + saved.foodShort;
    else if(saved.plannedShakes) preview.innerText = 'ü•§ Shake';
    else preview.innerText = '';

    cell.appendChild(num);
    cell.appendChild(preview);

    const today = new Date();
    if(M === today.getMonth()){
      if(d < today.getDate()) cell.classList.add('past');
      if(d === today.getDate()) cell.classL

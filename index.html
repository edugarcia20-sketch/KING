<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KING</title>
<meta name="theme-color" content="#e6f1f8" />
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABvElEQVRYR+2WwU3DMBBFXxMEUgBC0AQeAaUAB6AAfEoTgI0kHYB1pB0d7blJZDbTeL3nySu/OzM2eknmxwl7EqxUgtTjCOUKAo0ih7vYZ3cQgr7x9Rx0K6oZ+0uE0s4LUWZydh8aZa3EIPKOVF1DAc6vA5lk7Y4nyMWV/hAp61B/wmXL4/4KwwMLaT5X4D8d4KpD9EfBqBspDMb00pUu5ZOEe1m00kwXq9Wq/dUexnmY5SJL3YCVvw3BuH0wH6+IFPLg7R5mRgDVVql4hyzOhWEFgAASccF8x2OM/19t6xyqtUKJ/ToHUNxDWKYiIpn5jCIz7Ewn/bUSbY3u2u7MGNMiM+69ELMPWve1X1/FYmkIgAfHc91vq8E8JKw2TzORCJ6h3dRdrtdz+JR5yZOn95ikBA8Y6LazPcNyKgoAhnjPHU3TdM16vV5TqdTrmq9dr8ZGR6DqvV6r/X4nVgsVrtdbqYLCn8CRsP0f5M8KRwAAAABJRU5ErkJggg==" />

<style>
:root{
  --bg1: #eaf1f8;   /* azul-a√ßo frio mais claro */
  --card: #ffffff;  /* caixas claras */
  --muted: #6b7a90;
  --gold: #d4af37;
  --border: rgba(11,24,40,0.06);
  --shadow: 0 6px 18px rgba(12,24,40,0.06);
  --text:#082032;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue";-webkit-font-smoothing:antialiased;background:var(--bg1);color:var(--text)}
.app{
  max-width:1100px;margin:0 auto;padding:12px 12px 36px;
}
header.apphead{display:flex;align-items:flex-start;gap:12px;justify-content:space-between}
.brand{display:flex;flex-direction:column;gap:6px}
.titlewrap{display:flex;align-items:center;gap:12px}
h1{margin:0;font-size:20px;color:var(--text);font-weight:800;letter-spacing:0.2px}
.brand-sub{color:var(--muted);font-size:13px;margin-top:2px}
.header-controls{display:flex;gap:8px;align-items:center}
.btn{background:transparent;border:1px solid var(--border);padding:8px 10px;border-radius:10px;font-weight:700;color:var(--text);box-shadow:var(--shadow)}
.btn.primary{background:linear-gradient(180deg,#fff,#f6f9fc);border:1px solid rgba(0,0,0,0.03)}
.legend{font-size:13px;color:var(--muted);display:flex;gap:8px;align-items:center;margin-top:6px}

/* calendar grid */
.calendar-wrap{margin-top:12px;background:transparent;padding:6px;border-radius:12px}
.weekhead{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;padding:6px 6px 0}
.weekcell{font-weight:800;text-align:center;color:var(--text);font-size:13px}
.grid{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;margin-top:10px}
.cell{
  background:var(--card);
  min-height:96px;
  height:96px;
  border-radius:12px;
  border:1px solid var(--border);
  display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-start;padding:10px;
  box-shadow:var(--shadow);
  position:relative;
  transition:all .28s ease;
  overflow:hidden;
}
.cell .daynum{font-size:18px;font-weight:800;color:var(--text)}
.cell .preview{font-size:12px;color:var(--muted);margin-top:6px}
.cell.past{opacity:0.36;filter:grayscale(.12);transform:scale(.996)}
.cell.folga{background: linear-gradient(180deg, #fff5d6 0%, #fff9d6 100%); border:1px solid rgba(212,175,55,0.25)}
.cell.today{outline:3px solid rgba(100,160,255,0.25)}
/* fixed size for uniform grid */
@media(min-width:900px){ .cell{min-height:112px;height:112px} }

/* footer of header: folga legend below title */
.folga-legend{display:flex;flex-direction:row;gap:10px;align-items:center;margin-left:2px}
.folga-pill{background:rgba(212,175,55,0.12);color:#463409;padding:6px 8px;border-radius:999px;font-weight:700;font-size:13px}

/* modal styling */
.modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(4,8,16,0.45);z-index:60;padding:12px}
.panel{width:100%;max-width:920px;background:#fff;border-radius:12px;padding:14px;color:#0b2236;box-shadow:0 20px 60px rgba(4,8,16,0.15)}
.panel h2{margin:0 0 8px 0;color:#04223a}
.field{margin-bottom:8px}
.field label{display:block;font-size:13px;color:#324a5f;margin-bottom:6px}
input[type=text],textarea,select{width:100%;padding:10px;border:1px solid rgba(6,20,30,0.06);border-radius:8px;background:#fbfdff;color:#072033}
.save-row{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}

/* small screens adjustments */
@media(max-width:560px){
  .app{padding:10px}
  .cell{min-height:86px;height:86px;padding:8px}
  .weekcell{font-size:12px}
  .titlewrap h1{font-size:18px}
}
</style>
</head>
<body>
<div class="app">
  <header class="apphead">
    <div class="brand">
      <div class="titlewrap">
        <h1>üè∞ KING</h1>
        <div style="display:flex;flex-direction:column;">
          <div class="legend" id="folgaLegend"><span style="font-weight:700;color:#5a6b86">Folga:</span> <span class="folga-pill" id="nextFolgaLabel">‚Äî</span></div>
        </div>
      </div>
      <div class="brand-sub" id="subInfo">Calend√°rio inteligente ‚Äî sincronize para atualizar</div>
    </div>

    <div class="header-controls" role="toolbar">
      <button class="btn" id="saveLocal">Salvar</button>
      <button class="btn" id="exportBtn">Exportar</button>
    </div>
  </header>

  <div class="calendar-wrap" aria-live="polite">
    <div class="weekhead" id="weekhead"></div>
    <div class="grid" id="grid"></div>
  </div>
</div>

<!-- modal -->
<div class="modal" id="modal" aria-hidden="true">
  <div class="panel" role="dialog">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2 id="modalTitle">Dia</h2>
      <div><button class="btn" id="closeModal">Fechar</button></div>
    </div>
    <div style="margin-top:8px" id="modalBody"></div>
    <div class="save-row">
      <button class="btn" id="modalSave">Salvar</button>
    </div>
  </div>
</div>

<script>
/* KING v5.3 ‚Äî Home layout + adaptive calendar behavior
   Comportamento:
   - Usa m√™s atual se online; fallback para Novembro/2025 se offline.
   - Esmaece dias j√° passados.
   - Folgas destacadas (mais claras).
   - Cabe√ßalho dos dias em negrito; c√©lulas mostram apenas n√∫mero do dia.
   - Bot√µes Exportar e Salvar.
*/

/* ========== Configura√ß√µes ========= */
const FALLBACK = { year:2025, month:10 }; // Novembro 2025 (month is 0-based)
const folgas = new Set([4,9,18,23,24]); // folgas para Novembro
const storageKey = 'KING_local_days_v1';

/* detect month/year to render:
   if online -> use local date.
   if offline -> fallback month/year.
*/
function getRenderMonth(){
  if(navigator.onLine){
    const today = new Date();
    return { year: today.getFullYear(), month: today.getMonth() };
  } else {
    return { year: FALLBACK.year, month: FALLBACK.month };
  }
}

/* build week header (Dom..Sab) bold */
const weekNames = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];
const weekhead = document.getElementById('weekhead');
weekhead.innerHTML = '';
for(let i=0;i<7;i++){
  const d = document.createElement('div'); d.className='weekcell'; d.innerText = weekNames[i];
  weekhead.appendChild(d);
}

/* render calendar grid */
const grid = document.getElementById('grid');

function clearGrid(){ grid.innerHTML=''; }

function saveLocalBackup(obj){
  try{ localStorage.setItem(storageKey, JSON.stringify(obj)); alert('Salvo localmente.'); }
  catch(e){ alert('Erro ao salvar local: '+e); }
}

/* load day data from local storage (permanent edits) */
function loadDayData(){
  try{
    const raw = localStorage.getItem(storageKey);
    return raw? JSON.parse(raw) : {};
  }catch(e){ return {}; }
}
let dayData = loadDayData();

/* compute next folga label */
function updateFolgaLegend(renderYear, renderMonth){
  // find next folga (in that month) that is >= today if online, else show first folga
  let label='‚Äî';
  const today = new Date();
  for(const f of Array.from(folgas).sort((a,b)=>a-b)){
    const dt = new Date(renderYear, renderMonth, f);
    if(navigator.onLine){
      if(dt >= new Date(today.getFullYear(), today.getMonth(), today.getDate())){
        label = f + ' / ' + dt.toLocaleString('pt-BR',{month:'short'});
        break;
      }
    } else {
      // offline: show first folga of month
      label = f + ' / ' + dt.toLocaleString('pt-BR',{month:'short'});
      break;
    }
  }
  document.getElementById('nextFolgaLabel').innerText = label;
}

/* check if a given date is past relative to current date (today) */
function isPast(year, month, day){
  const now = new Date();
  const todayOnly = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const check = new Date(year, month, day);
  return check < todayOnly;
}

/* render function */
function renderCalendar(){
  const { year, month } = getRenderMonth();
  clearGrid();
  updateFolgaLegend(year, month);
  const first = new Date(year, month, 1);
  const lastDay = new Date(year, month+1, 0).getDate();
  const startWeekday = first.getDay();
  // fill empty head cells
  for(let i=0;i<startWeekday;i++){
    const e = document.createElement('div'); e.className='cell'; e.style.visibility='hidden';
    grid.appendChild(e);
  }
  for(let d=1; d<=lastDay; d++){
    const cell = document.createElement('div'); cell.className='cell';
    const num = document.createElement('div'); num.className='daynum'; num.innerText = d;
    const prev = document.createElement('div'); prev.className='preview';
    // simple preview from saved data if exists
    const key = `${year}-${(month+1).toString().padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const saved = dayData[key] || {};
    prev.innerText = saved.title || '';
    cell.appendChild(num);
    cell.appendChild(prev);
    // mark folga
    if(month === FALLBACK.month && year === FALLBACK.year && folgas.has(d)){
      cell.classList.add('folga');
    }
    // mark today
    const today = new Date();
    if(year === today.getFullYear() && month === today.getMonth() && d === today.getDate()){
      cell.classList.add('today');
    }
    // if past -> fade
    if(isPast(year, month, d)){
      cell.classList.add('past');
    }
    cell.onclick = ()=> openDayModal(year, month, d, key);
    grid.appendChild(cell);
  }
}

/* modal handling */
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
document.getElementById('closeModal').onclick = ()=> { modal.style.display='none'; modal.setAttribute('aria-hidden','true'); };

function openDayModal(year, month, day, key){
  modal.style.display='flex'; modal.setAttribute('aria-hidden','false');
  modalTitle.innerText = `Dia ${day} ‚Äî ${new Date(year, month, day).toLocaleString('pt-BR',{month:'long', year:'numeric'})}`;
  // load saved
  const saved = dayData[key] || {};
  modalBody.innerHTML = '';
  // Trabalho (read-only preview of schedule)
  const tDiv = document.createElement('div'); tDiv.className='field';
  tDiv.innerHTML = `<label>üè¢ Notas de trabalho / turno</label><input type="text" id="m_work" value="${escapeHtml(saved.work||'')}" />`;
  modalBody.appendChild(tDiv);
  // Alimenta√ß√£o
  const aDiv = document.createElement('div'); aDiv.className='field';
  aDiv.innerHTML = `<label>üçΩÔ∏è Alimenta√ß√£o (ex: Caf√© / Almo√ßo / Janta / P√≥s)</label><input type="text" id="m_food" value="${escapeHtml(saved.food||'')}" />`;
  modalBody.appendChild(aDiv);
  // Treino
  const trDiv = document.createElement('div'); trDiv.className='field';
  trDiv.innerHTML = `<label>üèãÔ∏è Treino (intensidade / notas)</label><input type="text" id="m_train" value="${escapeHtml(saved.train||'')}" />`;
  modalBody.appendChild(trDiv);
  // custom title preview
  const tit = document.createElement('div'); tit.className='field';
  tit.innerHTML = `<label>T√≠tulo curto (aparece no dia)</label><input type="text" id="m_title" value="${escapeHtml(saved.title||'')}" />`;
  modalBody.appendChild(tit);

  // save handler
  document.getElementById('modalSave').onclick = ()=>{
    const nw = document.getElementById('m_work').value.trim();
    const nf = document.getElementById('m_food').value.trim();
    const nt = document.getElementById('m_train').value.trim();
    const ntit = document.getElementById('m_title').value.trim();
    dayData[key] = { work: nw, food: nf, train: nt, title: ntit };
    // persist to localStorage
    localStorage.setItem(storageKey, JSON.stringify(dayData));
    // update UI: re-render grid
    renderCalendar();
    modal.style.display='none';
    modal.setAttribute('aria-hidden','true');
  };
}

/* helper escape */
function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* save all local-day changes to file (export download) */
document.getElementById('exportBtn').onclick = ()=>{
  const blob = new Blob([JSON.stringify(dayData,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'KING_backup_'+(new Date().toISOString().slice(0,10))+'.json';
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
};

/* Save button (explicit) ‚Äî saves current local data (already saved on modal but explicit save enforces persist) */
document.getElementById('saveLocal').onclick = ()=>{
  try{
    localStorage.setItem(storageKey, JSON.stringify(dayData));
    alert('Altera√ß√µes salvas localmente.');
  }catch(e){ alert('Erro ao salvar: '+e) }
};

/* render initial */
renderCalendar();

/* auto-refresh when connection status changes: if we go online, recalc month (useful to switch to current month) */
window.addEventListener('online', ()=>{
  // when coming online, switch to current month/year
  renderCalendar();
  document.getElementById('subInfo').innerText = 'Sincronizado ‚Äî exibindo m√™s atual';
});
window.addEventListener('offline', ()=>{
  document.getElementById('subInfo').innerText = 'Offline ‚Äî mostrando m√™s de fallback';
});

</script>
</body>
</html>



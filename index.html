<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KING ‚Äî v5.6 Nutri√ß√£o Viva</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<meta name="theme-color" content="#0a0a0a">
<style>
:root{
  --bg:#0a0a0a; --card:#0f1112; --text:#f8f8f8; --muted:#c0c0c0; --gold:#d4af37; --red:#8b0000; --glass:rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:'Poppins',sans-serif;-webkit-font-smoothing:antialiased}
.container{max-width:1120px;margin:10px auto;padding:12px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px}
.brand{display:flex;flex-direction:column}
.title{font-size:20px;font-weight:700;letter-spacing:0.6px}
.subtitle{color:var(--muted);font-size:13px;margin-top:4px}
.controls{display:flex;gap:8px;align-items:center}
.btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:var(--text);cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--gold),#ffd66b);color:#0a0a0a;font-weight:700;border:0}
.note{font-size:12px;color:var(--muted)}
/* monthly progress */
.monthly-wrap{position:relative;margin-top:12px}
.monthly-bar{height:6px;background:transparent;border-radius:6px;backdrop-filter:blur(4px);border:1px solid rgba(255,255,255,0.03)}
.monthly-fill{height:100%;width:0;background:linear-gradient(90deg,var(--gold),#ffd66b);border-radius:6px;box-shadow:0 6px 20px rgba(212,175,55,0.12);transition:width .9s ease}
.monthly-label{font-size:12px;color:var(--muted);margin-top:6px}

/* grid layout */
.main-grid{display:grid;grid-template-columns:1fr 380px;gap:18px;margin-top:14px}
@media(max-width:980px){ .main-grid{grid-template-columns:1fr;}}
.left{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03)}
.right{display:flex;flex-direction:column;gap:12px}
.card{background:linear-gradient(180deg,#0f1112,#0b0b0b);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04)}

/* calendar */
.weekhead{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
.weekcell{font-weight:700;text-align:center;color:var(--muted);font-size:12px}
.grid{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;margin-top:10px}
.cell{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);min-height:98px;border-radius:10px;padding:8px;border:1px solid rgba(255,255,255,0.03);position:relative;cursor:pointer;overflow:hidden;display:flex;flex-direction:column}
.daynum{font-weight:700;font-size:16px}
.preview{font-size:12px;color:var(--muted);margin-top:6px}
.cell.today{box-shadow:0 10px 30px rgba(212,175,55,0.06);outline:3px solid rgba(212,175,55,0.06)}
.cell.folga{background: linear-gradient(180deg, rgba(139,0,0,0.05), rgba(212,175,55,0.02));border:1px solid rgba(139,0,0,0.12)}
.cell.past{opacity:0.5;filter:grayscale(.08)}
/* small badge */
.badge{position:absolute;right:8px;top:8px;background:rgba(0,0,0,0.35);padding:4px 8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);font-size:12px;color:var(--muted)}

/* right column components */
.pizza-row{display:flex;gap:12px;align-items:center}
.pizza{width:180px;height:180px;border-radius:8px;background:transparent}
.metrics{flex:1}
.metric{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px dashed rgba(255,255,255,0.03)}
.metric strong{font-size:13px}
.metric .val{font-weight:700;color:var(--gold)}
.week-bars{margin-top:10px}
.week-row{display:flex;gap:8px;align-items:flex-end;height:80px}
.week-col{flex:1;text-align:center}
.week-bar{width:100%;height:0;background:linear-gradient(180deg,var(--gold),#ffd66b);border-radius:8px;transition:height .6s}

/* hyd */
.hyd-row{display:flex;gap:8px;align-items:center}
.bottle{width:72px;height:86px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;align-items:center;justify-content:center}
.bottle .lvl{font-weight:800;color:var(--gold);font-size:18px}
.drop{background:transparent;border:1px solid rgba(255,255,255,0.05);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}
.small{font-size:12px;color:var(--muted)}

/* bau */
.bau-list{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.bau-item{background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)}

/* modal */
.modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:90;padding:12px}
.modal .panel{width:100%;max-width:780px;background:linear-gradient(180deg,#0a0a0a,#0b0b0b);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.04)}
.input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
.action-row{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}
.action{padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
.action.primary{background:var(--gold);color:#0a0a0a;font-weight:700}

/* misc */
.center{display:flex;align-items:center;justify-content:center}
.footer-space{height:96px}
</style>
</head>
<body>
<div class="container">
  <header class="header">
    <div class="brand">
      <div class="title">üè∞ KING</div>
      <div class="subtitle">Preview v5.6 ‚Äî Nutri√ß√£o Viva ‚Ä¢ Tema: Poppins ‚Ä¢ Paleta: Preto / Vermelho / Prata / Dourado</div>
    </div>
    <div class="controls">
      <button class="btn" id="exportBtn">Exportar</button>
      <button class="btn primary" id="openBAU">Abrir BA√ö</button>
    </div>
  </header>

  <div class="monthly-wrap">
    <div class="monthly-bar" aria-hidden="true"><div class="monthly-fill" id="monthlyFill"></div></div>
    <div class="monthly-label">Progresso mensal: <span id="monthlyPct">0%</span></div>
  </div>

  <main class="main-grid">
    <section class="left">
      <div class="weekhead" id="weekhead"></div>
      <div class="grid" id="calGrid" aria-live="polite" role="grid"></div>
    </section>

    <aside class="right">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Painel de Sa√∫de</strong>
          <div class="small">Meta kcal: <span id="metaKc">2606</span> ‚Ä¢ √Ågua: <span id="metaAg">2100</span> ml</div>
        </div>
        <div class="pizza-row" style="margin-top:12px">
          <canvas id="pizzaCanvas" class="pizza" aria-hidden="true"></canvas>
          <div class="metrics">
            <div class="metric"><strong>√Ågua</strong><div class="val" id="aguaNow">0 / 2100</div></div>
            <div class="metric"><strong>Kcal</strong><div class="val" id="kcalNow">0 / 2606</div></div>
            <div class="metric"><strong>Sono</strong><div class="val" id="sonoNow">0 / 8h</div></div>
            <div class="metric"><strong>Treino</strong><div class="val" id="treinoNow">‚Äî</div></div>
          </div>
        </div>

        <div class="week-bars">
          <div style="display:flex;justify-content:space-between;align-items:center"><strong>Semana atual</strong><div class="small">Toque uma barra</div></div>
          <div class="week-row" id="weekRow"></div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Hidrata√ß√£o</strong>
          <div class="small">Meta hoje: <span id="metaWater">2100</span> ml</div>
        </div>
        <div style="margin-top:10px" class="hyd-row">
          <div class="bottle center" id="bottleA"><div class="lvl" id="lvlA">0/4</div><div class="small">Garrafa A</div></div>
          <div class="bottle center" id="bottleB"><div class="lvl" id="lvlB">0/4</div><div class="small">Garrafa B</div></div>
          <div style="display:flex;flex-direction:column;gap:8px">
            <button class="drop" id="addDrop">+25 ml</button>
            <div class="small">Total: <span id="totWater">0</span> ml</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>BA√ö (preview)</strong>
          <div class="small">Itens: <span id="bauCount">0</span></div>
        </div>
        <div style="margin-top:8px" class="bau-list" id="bauList"></div>
      </div>
    </aside>
  </main>

  <div class="footer-space"></div>
</div>

<!-- Day modal -->
<div class="modal" id="dayModal" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong id="modalTitle">Dia</strong>
      <button class="action" id="closeDay">Fechar</button>
    </div>
    <div style="margin-top:12px">
      <div class="small">üè¢ Hor√°rio de trabalho (refer√™ncia)</div>
      <div style="margin:8px 0 12px" id="modalWork"></div>
      <div class="small">üçΩÔ∏è Alimenta√ß√£o sugerida (baseada no BA√ö)</div>
      <div style="margin-top:8px;background:rgba(255,255,255,0.01);padding:10px;border-radius:8px" id="modalMeals"></div>
      <div class="action-row">
        <button class="action primary" id="confirmMealsBtn">‚úÖ Confirmar consumo</button>
      </div>
    </div>
  </div>
</div>

<!-- BAU modal -->
<div class="modal" id="bauModal" aria-hidden="true">
  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>BA√ö ‚Äî Gerenciar</strong>
      <button class="action" id="closeBau">Fechar</button>
    </div>
    <div style="margin-top:12px">
      <div style="display:flex;gap:8px">
        <input class="input" id="newItemName" placeholder="Nome do item (ex: Banana)"/>
        <input class="input" id="newItemQty" style="width:120px" placeholder="Qtd (ex: 5, 500g)"/>
        <button class="btn" id="addItemBtn">Adicionar</button>
      </div>
      <div id="manageList" style="margin-top:12px"></div>
    </div>
  </div>
</div>

<script>
/* KING v5.6 ‚Äî main logic (preview / local) */

/* --------- Config & initial BAU ---------- */
const storagePrefix = 'KING_v56_';
const bauKey = storagePrefix + 'bau';
const dayKey = storagePrefix + 'dayData';
const hydKey = storagePrefix + 'hydration';
const healthKey = storagePrefix + 'health';

const meta = { kcal:2606, agua:2100, sono:8 };

/* initial bau items (based on your list) */
const bauInitial = [
  {nome:'Banana', setor:'Geladeira', qtd:5, unidade:'un', kcal100:89},
  {nome:'Anabolic Mass', setor:'Despensa', qtd:1000, unidade:'g', kcal150:580}, // 150g -> 580kcal
  {nome:'Leite (aberto)', setor:'Geladeira', qtd:500, unidade:'ml', kcal100:60},
  {nome:'Mel Silvestre', setor:'Despensa', qtd:1250, unidade:'ml', kcal100:304},
  {nome:'Ovos', setor:'Geladeira', qtd:11, unidade:'un', kcal100:155},
  {nome:'P√£o franc√™s', setor:'Despensa', qtd:4, unidade:'un', kcal100:275},
  {nome:'Arroz cozido (geladeira)', setor:'Geladeira', qtd:500, unidade:'g', kcal100:130},
  {nome:'Pur√™ de batata (geladeira)', setor:'Geladeira', qtd:500, unidade:'g', kcal100:90},
  {nome:'Lingui√ßa calabresa', setor:'Geladeira', qtd:2, unidade:'un', kcal100:300}
];

function saveJSON(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
function loadJSON(k, fallback){ try{ const s = localStorage.getItem(k); return s?JSON.parse(s):fallback; }catch(e){return fallback;} }

/* load or init */
let bau = loadJSON(bauKey, bauInitial);
let dayData = loadJSON(dayKey, {});
let hydration = loadJSON(hydKey, {bottles:[0,0], extra:0});
let health = loadJSON(healthKey, {}); // store per-date objects including equilibrium

/* -------- render week head -------- */
const weekNames = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];
const weekhead = document.getElementById('weekhead');
for(let i=0;i<7;i++){ const el = document.createElement('div'); el.className='weekcell'; el.textContent = weekNames[i]; weekhead.appendChild(el); }

/* -------- calendar render (fallback month Nov sample) -------- */
const calGrid = document.getElementById('calGrid');
const folgas = new Set([4,9,18,23,24]); // user's folgas
function renderCalendar(){
  calGrid.innerHTML = '';
  const year = new Date().getFullYear();
  const month = new Date().getMonth(); // current month
  const days = new Date(year, month+1, 0).getDate();
  // find weekday of 1st
  const firstW = new Date(year, month, 1).getDay();
  for(let i=0;i<firstW;i++){ const spacer=document.createElement('div'); spacer.className='cell'; spacer.style.visibility='hidden'; calGrid.appendChild(spacer); }
  for(let d=1; d<=days; d++){
    const c = document.createElement('div'); c.className='cell'; 
    const dn = document.createElement('div'); dn.className='daynum'; dn.innerText = d;
    c.appendChild(dn);
    const pv = document.createElement('div'); pv.className='preview';
    const key = dateKey(year, month+1, d);
    const saved = dayData[key] || {};
    if(saved.food) pv.innerText = 'üçΩ ' + (saved.foodShort || saved.food.split('\\n')[0]);
    else pv.innerText = '';
    c.appendChild(pv);
    if(folgas.has(d)) c.classList.add('folga');
    const now = new Date();
    if(d===now.getDate() && month===now.getMonth() && year===now.getFullYear()) c.classList.add('today');
    if(new Date(year,month,d) < new Date(now.getFullYear(), now.getMonth(), now.getDate())) c.classList.add('past');
    // badge for urgent items like rent ‚Äî for demo none
    c.onclick = ()=> openDayModal(year, month, d, key);
    calGrid.appendChild(c);
  }
}
function dateKey(y,m,d){ return `${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`; }
renderCalendar();

/* -------- BAU rendering -------- */
function renderBAU(){
  const el = document.getElementById('bauList'); el.innerHTML='';
  bau.forEach((it,idx)=>{
    const item = document.createElement('div'); item.className='bau-item';
    item.innerHTML = `<strong>${it.nome}</strong><div class="small">${it.setor} ‚Ä¢ ${it.qtd}${it.unidade||''}</div>
      <div style="display:flex;gap:6px;margin-top:8px"><button class="btn" onclick="useItem(${idx})">Usar</button><button class="btn" onclick="editItem(${idx})">Editar</button></div>`;
    el.appendChild(item);
  });
  document.getElementById('bauCount').innerText = bau.length;
}
window.useItem = function(i){
  const it = bau[i];
  const amt = prompt(`Quanto usar de "${it.nome}"? (ex: 1, 150)`, it.unidade==='un'? '1':'100');
  if(amt!==null){ const n = parseFloat(amt)||1; it.qtd = Math.max(0, it.qtd - n); saveJSON(bauKey, bau); renderBAU(); updateHealthPanel(); }
}
window.editItem = function(i){
  const it = bau[i];
  const name = prompt('Nome', it.nome); if(name!==null){ it.nome = name; saveJSON(bauKey,bau); renderBAU(); }
}

/* BAU modal controls */
document.getElementById('openBAU').onclick = ()=> { openBau(); };
document.getElementById('closeBau').onclick = ()=> { closeBau(); };
document.getElementById('addItemBtn').onclick = ()=> {
  const name = document.getElementById('newItemName').value.trim(); const qty = parseFloat(document.getElementById('newItemQty').value) || 1;
  if(!name) return alert('Nome vazio'); bau.push({nome:name,setor:classify(name),qtd:qty,unidade: (Number.isInteger(qty)?'un':''), kcal100:0}); saveJSON(bauKey,bau); renderBAU(); renderManage(); document.getElementById('newItemName').value=''; document.getElementById('newItemQty').value='';
};

function openBau(){ document.getElementById('bauModal').style.display='flex'; renderManage(); }
function closeBau(){ document.getElementById('bauModal').style.display='none'; }
function renderManage(){ const el = document.getElementById('manageList'); el.innerHTML=''; bau.forEach((it,idx)=>{ const row = document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.padding='6px 0'; row.innerHTML = `<div><strong>${it.nome}</strong> <div class="small">${it.setor} ‚Ä¢ ${it.qtd}${it.unidade||''}</div></div><div style="display:flex;gap:6px"><button class="btn" onclick="useItem(${idx})">Usar</button><button class="btn" onclick="editItem(${idx})">Editar</button></div>`; el.appendChild(row); }); }

/* classify heuristic */
function classify(name){
  const s = name.toLowerCase();
  if(s.includes('banana')||s.includes('ovo')||s.includes('leite')) return 'Geladeira';
  if(s.includes('arroz')||s.includes('feij√£o')||s.includes('farinha')||s.includes('granola')) return 'Despensa';
  if(s.includes('fone')||s.includes('placa')||s.includes('monitor')) return 'Digital';
  return 'Outros';
}

/* -------- Hydration controls -------- */
const lvlA = document.getElementById('lvlA'), lvlB = document.getElementById('lvlB'), totWater = document.getElementById('totWater');
document.getElementById('bottleA').onclick = ()=> { hydration.bottles[0] = Math.min(4, hydration.bottles[0] + 1); saveHyd(); updateHydUI(); updateHealthPanel(); };
document.getElementById('bottleB').onclick = ()=> { hydration.bottles[1] = Math.min(4, hydration.bottles[1] + 1); saveHyd(); updateHydUI(); updateHealthPanel(); };
document.getElementById('addDrop').onclick = ()=> { hydration.extra = (hydration.extra||0) + 25; saveHyd(); updateHydUI(); updateHealthPanel(); };

function saveHyd(){ saveJSON(hydKey, hydration); }
function updateHydUI(){ lvlA.innerText = hydration.bottles[0] + '/4'; lvlB.innerText = hydration.bottles[1] + '/4'; const tot = hydration.bottles[0]*125 + hydration.bottles[1]*125 + (hydration.extra||0); totWater.innerText = tot; document.getElementById('aguaNow').innerText = tot + ' / ' + meta.agua; }
updateHydUI();

/* -------- Day modal (open/edit) ---------- */
const dayModal = document.getElementById('dayModal');
function openDayModal(y,m,d,key){
  dayModal.style.display='flex'; document.getElementById('modalTitle').innerText = `Dia ${d} ‚Äî ${new Date(y,m,d).toLocaleDateString()}`;
  // work time
  document.getElementById('modalWork').innerText = getWorkTime(y,m,d);
  // meals suggestions
  const meals = generateMealsForDay(y,m,d);
  const container = document.getElementById('modalMeals'); container.innerHTML='';
  meals.forEach(s=>{
    const row = document.createElement('div'); row.style.marginBottom='8px';
    row.innerHTML = `<strong>${s.time} ‚Ä¢ ${s.title}</strong><div class="small" style="margin-top:4px">${s.items.join(', ')}</div><div class="small" style="margin-top:4px">‚âà ${s.kcal} kcal</div>`;
    container.appendChild(row);
  });
}
document.getElementById('closeDay').onclick = ()=> dayModal.style.display='none';
document.getElementById('confirmMealsBtn').onclick = ()=> { alert('Refei√ß√µes confirmadas (preview). Ao confirmar na vers√£o final, o BA√ö ser√° debitado.'); dayModal.style.display='none'; };

/* work time heuristic (1h travel + 20m early => 1h20 before entry) */
function getWorkTime(y,m,d){
  // use weekday mapping the user gave
  const wd = new Date(y,m,d).getDay();
  // mapping derived from earlier conversation (times are entry times then adjusted)
  switch(wd){
    case 0: return 'Entrada 15:00 ‚Äî sa√≠da 00:20 (Dom)';
    case 1: return 'Entrada 14:00 ‚Äî sa√≠da 22:20 (Seg)';
    case 2: return 'Entrada 14:00 ‚Äî sa√≠da 22:20 (Ter)';
    case 3: return 'Entrada 18:00 ‚Äî sa√≠da 01:20 (Qua)';
    case 4: return 'Entrada 19:00 ‚Äî sa√≠da 02:20 (Qui)';
    case 5: return 'Entrada 19:00 ‚Äî sa√≠da 02:20 (Sex)';
    case 6: return 'Entrada 19:00 ‚Äî sa√≠da 02:20 (S√°b)';
    default: return '';
  }
}

/* -------- Meal suggestion engine (uses BAU) -------- */
function generateMealsForDay(y,m,d){
  // returns array of meals with time,title,items,kcal
  const has = name => bau.some(b => b.nome.toLowerCase().includes(name.toLowerCase()) && b.qtd>0);
  const meals = [];
  // breakfast: 2 eggs + banana + bread if available
  const br = [];
  if(has('Ovos') || has('ovo')) br.push('2 ovos');
  if(has('Banana') || has('banana'))
